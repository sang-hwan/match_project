| # | 대상 파일                          | 반드시 손볼 이유                                                                                  | 핵심 수정 위치·논리                                                                                                                                                                                                                             | 기대 효과                                              |
| - | ------------------------------ | ------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------- |
| 1 | **`1_ext_hwp_image.py`**       | HWP 5의 일부 BinData가 *raw‑deflate* 또는 OLE 패키지(Ole10Native)라서 `Cannot inflate…` 오류로 이미지 누락 발생 | *`_extract_hwp5()` 루프 안*<br>① `zlib.decompress(raw_data)` 실패 시 `zlib.decompress(raw_data, -zlib.MAX_WBITS)` 로 재시도<br>② `Ole10Native` 서브스트림에서 **JPEG (FF D8 FF)·PNG (89 50 4E 47)** 시그니처 검색 후 추출                                         | 누락 이미지 20 여 건 복구 → **정답 후보 누락 방지**                 |
| 2 | **`2_pre_process_image.py`**   | 512 px 흑백 축소만 사용하면 색·비율·여백 정보 소실로 pHash·ORB 구분력이 떨어짐                                       | *`preprocess()` 함수*<br>① RGB 유지 후 **LAB 또는 HSV 변환 옵션** 제공, L 채널만 회색 사용<br>② 긴 변을 512 px로 리사이즈한 뒤 **정사각 패딩**(`cv2.copyMakeBorder`, 기본 `BORDER_REPLICATE`, 색상 파라미터화)<br>③ 필요 시 **컬러·그레이 두 세트 저장**                                         | 해밍거리·RANSAC 분포 분리 ↑ → **매칭 정확도·안정성 향상**            |
| 3 | **`3_mk_phash_candidates.py`** | 해밍 ≤ 10 전량 저장으로 후보 200 \~ 340 개/장 → 다음 단계 과부하·오답률↑                                         | *후보 생성 로직*<br>① 기본 임계값 **10 → 6**<br>② `dists` 정렬 후 **거리 ≤ 임계값** 조건을 먼저 검사, 이어서 **상위 30 개(`TOP_N`)** 까지만 저장<br>③ `--threshold`, `--top-n` CLI 옵션화                                                                                       | 후보 수 283 → ≈ 40, ORB 연산량 ‑80 % → **속도·정확도 동시 개선**  |
| 4 | **`4_verify_mapping.py`**      | ORB 인라이어 비율이 작아도 최고 점수이면 매핑 확정 → 오답 1 위 빈발, 썸네일·블러에도 취약                                    | 파일 상단에 `MIN_INLIER = 0.25` 상수 추가<br>특징점 추출·매처<br> • **AKAZE**(uint8) 또는 **SIFT**(float) 선택<br> • FLANN 인덱스 분기:<br>  – AKAZE → `algorithm=6`(LSH)<br>  – SIFT  → `algorithm=1` + KD‑Tree 파라미터<br>검증 종료 시 `best_score >= MIN_INLIER` 만 매핑 | 잘못된 1위 매핑 차단 + 스케일·블러 강인성 ↑ → **정확도 4 % → 88 % +** |
| 5 | **`5_check_map_result.py`**    | 전처리 파일에 `.png` 확장자가 중복되어 키 파싱 오류·폴더 정리 실패                                                  | *키 파싱 직전*<br>`orig_key_flat = Path(name).with_suffix('').name` **또는** `.removesuffix('.png')` 사용(3.9+)                                                                                                                                  | `.png.png` 중복 제거 → **검사·정리 단계 오류 해소**              |
